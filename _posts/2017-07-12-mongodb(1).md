---
layout: post
title:  mongoDB
date:   2017-07-12 19:26:00 +0800
categories: mongoDB FOR Node.js
tag: mongoDB
---

* content
{:toc}

### 1. MongoDB安装、配置(windows)

*下载MongoDB并安装*

下载地址：`http://www.mongodb.org/downloads`

*创建数据库和日志存放目录*

在C盘根目录下新建 `M_DB` 和 `M_LOG` 两个文件夹，分别存放数据库文件和日志文件

*创建一个config文件*

打开目录 `C:\Program Files\MongoDB\Server\3.4\bin`，并在此目录下新建一个 `mongo.config` 文件，文件内容如下

```
##数据库目录
dbpath=C:\M_DB

##日志输出文件
logpath=C:\M_LOG\mongodb.log
```

*添加环境变量*

在环境变量PATH中加入 `C:\Program Files\MongoDB\Server\3.4\bin`

*以Windows服务器运行MongoDB*

以管理员方式打开CMD窗口，运行如下命令安装MongoDB服务，可以在 “控制面板\所有控制面板项\管理工具\服务”找到名为“MongoDB”的服务右键启动

```
mongod --config "C:\Program Files\MongoDB\Server\3.4\bin\mongo.config" --install
```

*启动服务*

在CMD窗口中运行如下命令，也可以在可以在 “控制面板\所有控制面板项\管理工具\服务”

```
net start mongodb
```

*测试连接*

在CMD中运行如下命令，查看结果

```
mongo
```

MongoDB默认端口是 `27017`，可以修改

`.exe` 文件：

	mongo.exe：客户端，支持js语法
	mongod.exe：服务端
	mongodump.exe：备份工具
	mongorestore.exe：恢复工具
	mongoexport.exe：导出工具
	mongoimport.exe：导入工具
	mongostat.exe：实时性能监控工具
	mongotop.exe：跟踪MongDB实例读写时间工具

### 2. MongoDB基本概念

下表列出了 RDBMS 与 MongoDB 对应的术语：

```
RDBMS	MongoDB
数据库	数据库
表格	集合
行	    文档
列	    字段
表联合	嵌入文档
主键	主键 (MongoDB 提供了 key 为 _id )

数据库服务和客户端

Mysqld/Oracle	mongod
mysql/sqlplus	mongo
```

*需要注意的是：*

文档中的键/值对是有序的。

文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。
MongoDB区分类型和大小写。

MongoDB的文档不能有重复的键。

文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。

*文档键命名规范：*

键不能含有\0 (空字符)。这个字符用来表示键的结尾。

.和$有特别的意义，只有在特定环境下才能使用。

以下划线"_"开头的键是保留的(不是严格要求的)。

*元数据：*

```
集合命名空间	               描述
dbname.system.namespaces	列出所有名字空间。
dbname.system.indexes	    列出所有索引。
dbname.system.profile	    包含数据库概要(profile)信息。
dbname.system.users	        列出所有可访问数据库的用户。
dbname.local.sources	    包含复制对端（slave）的服务器信息和状态。
```

### 3. [基本语法](https://docs.mongodb.com/manual/reference/method/db.collection.aggregate/)

```
显示当前数据库: db
新建数据库：第一步：use 新建数据库名；第二步：进行此库相关的操作；如果不进行第二步，该数据库不会被创建
查看数据库：show dbs;
新建表：db.createCollection('要新建的表名');
查看当前数据库下表： show collections;
删除当前数据库指定表：db.表名.drop();
删除当前数据库：db.dropDatabase();
```

运行"use"命令，也可以连接到一个指定的数据库

有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。

`admin`： 从权限的角度来看，这是"root"数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。

`local`: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合

`config`: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。

*插入：*

```
db.COLLECTION_NAME.insert(document)

db.COLLECTION_NAME.save(document)  
//如果不指定 _id 字段 save() 方法类似于 insert() 方法。如果指定 _id 字段，则会更新该 _id 的数据。

db.COLLECTION_NAME.insertOne():向指定集合中插入一条文档数据
db.COLLECTION_NAME.insertMany():向指定集合中插入多条文档数据

//example
db.col.insert({title: 'MongoDB', likes: 100})
```

以上实例中 col 是我们的表名，如果该表不在该数据库中， MongoDB 会自动创建该表。