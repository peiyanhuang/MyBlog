---
layout: post
title:  Session、Cookie、Token 的区别与联系
date:   2018-08-15 19:58:00 +0800
categories: 网络安全
tag: 开发者
---

* content
{:toc}

### Session 与 Cookie 的区别与联系

http 协议是一种无状态的协议，浏览器对服务器的每一次请求都是独立的。为了使得 web 能够产生一些动态信息，就需要保存“状态”，而 cookie 和 session 机制就是为了解决 http 协议无状态而产生。cookie 是一种在客户端保存状态的方案，session 是一种在服务器端保存状态的方案。

一句话道明这两者的区别：“session 是一种网络通讯的会话机制，而 cookie 只是目前实现这种机制的主流方案里面的一个参与者，它一般是用于保存 session ID。从集合的概念来说，你可以吧 session 看作 cookie 的超集。”

Session 可以记录用户的登录与行为数据，即记录下用户目前访问服务器上的那些内容，状态是什么，而考虑到这些数据用户修改的随意性很大，并没有必要直接存储在数据库中。

在用户执行刷新操作时，即再次访问服务器时，可以直接根据 Session，打开用户上次访问时网页的状态（如用户输入的表单内容等等），为用户带来更优的体验，提供个性化服务。

用户的 session 信息非常关键，它记录了用户在进入页面、查看结果、点击结果以及后继的操作（比如翻页、加购物车等）。只有通过session信息才能把用户的行为联系起来，构建出完整的模型，因此从海量数据中把每一个用户所有 session 的操作都完整地挖掘出来非常重要。Session其实就是会话变量的保存地，只要是能使用变量的地方，都能使用 Sesion 变量。比如可以用来计数、存储临时信息、甚至还可以存储DataTable，只要你的服务器的内存足够大就行。

具体来说 cookie 机制采用的是在客户端保持状态的方案，而 session 机制采用的是在服务器端保持状态的方案。两者存储的都是用户登录信息，操作行为等等的数据。

cookie 是把用户的数据写在用户本地浏览器上。Session 是由服务器创建的，是把用户的数据写在用户的独占 session 上，存储在服务器上，一般只将 session 的id 存储在 cookie 中。

通常 session 是不能跨窗口使用的，当你新开了一个浏览器窗口进入相同页面时，系统会赋予你一个新的 sessionid，这样我们信息共享的目的就达不到了，此时我们可以先把 sessionid 保存在 cookie 中，然后在新窗口中读出来，就可以得到上一个窗口 SessionID 了，这样通过session 和 cookie 的结合我们就实现了跨窗口的 session tracking（会话跟踪）。

服务器会把长时间没有活动的Session从服务器内存中清除，此时Session便失效，具体根据服务器设置。

除了 cookie 还有一种url重写的方法也能够实现 session 机制。

### Token

比如说，小F已经登录了系统，我给他发一个令牌(token)，里边包含了小F的 user id，下一次小F再次通过 Http 请求访问我的时候，把这个token 通过Http header 带过来不就可以了。

不过这和 session id 没有本质区别啊，任何人都可以可以伪造，所以我得想点儿办法，让别人伪造不了。

那就对数据做一个签名吧，比如说我用 HMAC-SHA256 算法，加上一个只有我才知道的密钥，对数据做一个签名，把这个签名和数据一起作为 token，由于密钥别人不知道，就无法伪造 token 了。

这个 token 我不保存，当小F把这个 token 给我发过来的时候，我再用同样的 HMAC-SHA256 算法和同样的密钥，对数据再计算一次签名，和token 中的签名做个比较，如果相同，我就知道小F已经登录过了，并且可以直接取到小F的 user id, 如果不相同，数据部分肯定被人篡改过， 我就告诉发送者：对不起，没有认证。

Token 中的数据是明文保存的(虽然我会用Base64做下编码，但那不是加密)，还是可以被别人看到的，所以我不能在其中保存像密码这样的敏感信息。

当然，如果一个人的 token 被别人偷走了，那我也没办法，我也会认为小偷就是合法用户，这其实和一个人的 session id 被别人偷走是一样的。

这样一来， 我就不保存 session id 了，我只是生成 token, 然后验证 token，我用我的CPU计算时间获取了我的 session 存储空间 ！

原文：[彻底理解cookie，session，token](https://www.cnblogs.com/moyand/p/9047978.html)
