---
layout: post
title:  搭建linux虚拟机服务器
date:   2017-05-08 21:38:00 +0800
categories: 2017
tag: 开发者
---

* content
{:toc}

### 1.准备工具

包括 VirtualBox、CentOS 7、Xftp 5、Xshell 5

### 2.安装虚拟机

虚拟机安装很简单，就不说了。

注意：[virtualBox虚拟机没有64位选项的问题](http://www.askmaclean.com/archives/vbox-virtualbox-64-bit.html)

这要说下虚拟机“网络”的配置：连接方式选择 - 桥接网卡；高级里面的混杂模式可以选为 - 全部允许

#### 四种网络连接

这里解释下VirtualBox的四种网络连接方式：

- 1.NAT
- 2.Bridged Adapter
- 3.Internal
- 4.Host-only Adapter

VMWare中有三种，其实他跟VMWare 的网络连接方式都是一样概念，只是比VMWare多了Internal方式。

通过这张图就很容易看出这4种方式的区别：

|				|	NAT		|	Bridged Adapter	|	Internal	|	Host-only Adapter |
|	:----: 		|	:----:	|	:----:			|	:----:		|	:-----:			  |
|虚拟机->主机	|	&#8730;	|	&#8730;			|	&#935;		|	默认不需设置	  |
|主机->虚拟机	|	&#935;	|	&#8730;			|	&#935;		|	默认不需设置	  |
|虚拟机->其他主机	|	&#8730;	|	&#8730;		|	&#935;		|	默认不需设置	  |
|其他主机->虚拟机	|	&#935;	|	&#8730;		|	&#935;		|	默认不需设置	  |
|虚拟机之间		|	&#935;	|	&#8730;			|同网络名下可以	|	&#8730;			  |

1、NAT

NAT：Network Address Translation，网络地址转换

NAT模式是最简单的实现虚拟机上网的方式，你可以这样理解：

Guest访问网络的所有数据都是由主机提供的，Guest并不真实存在于网络中，主机与网络中的任何机器都不能查看和访问到Guest的存在。

Guest可以访问主机能访问到的所有网络，但是对于主机以及主机网络上的其他机器，Guest又是不可见的，甚至主机也访问不到Guest。

虚拟机与主机的关系：只能单向访问，虚拟机可以通过网络访问到主机，主机无法通过网络访问到虚拟机。

虚拟机与网络中其他主机的关系：只能单向访问，虚拟机可以访问到网络中其他主机，其他主机不能通过网络访问到虚拟机。

虚拟机与虚拟机的关系：相互不能访问，虚拟机与虚拟机各自完全独立，相互间无法通过网络访问彼此。

2、Bridged Adapter（网桥模式）

网桥模式，你可以这样理解：

它是通过主机网卡，架设了一条桥，直接连入到网络中了。因此，它使得虚拟机能被分配到一个网络中独立的IP，所有网络功能完全和在网络中的真实机器一样。

网桥模式下的虚拟机，你把它认为是真实计算机就行了。

虚拟机与主机的关系：可以相互访问，因为虚拟机在真实网络段中有独立IP，主机与虚拟机处于同一网络段中，彼此可以通过各自IP相互访问。

虚拟机于网络中其他主机的关系：可以相互访问，同样因为虚拟机在真实网络段中有独立IP，虚拟机与所有网络其他主机处于同一网络段中，彼此可以通过各自IP相互访问。

虚拟机与虚拟机的关系：可以相互访问，原因同上。

3、Internal（内网模式）

内网模式，顾名思义就是内部网络模式：

虚拟机与外网完全断开，只实现虚拟机于虚拟机之间的内部网络模式。

虚拟机与主机的关系：不能相互访问，彼此不属于同一个网络，无法相互访问。

虚拟机与网络中其他主机的关系：不能相互访问，理由同上。

虚拟机与虚拟机的关系：可以相互访问，前提是在设置网络时，两台虚拟机设置同一网络名称。如上配置图中，名称为intnet。

4、Host-only Adapter（主机模式）

主机模式，这是一种比较复杂的模式，需要有比较扎实的网络基础知识才能玩转。可以说前面几种模式所实现的功能，在这种模式下，通过虚拟机及网卡的设置都可以被实现。

我们可以理解为Guest在主机中模拟出一张专供虚拟机使用的网卡，所有虚拟机都是连接到该网卡上的，我们可以通过设置这张网卡来实现上网及其他很多功能，比如（网卡共享、网卡桥接等）。

虚拟机与主机的关系：默认不能相互访问，双方不属于同一IP段，host-only网卡默认IP段为192.168.56.X 子网掩码为255.255.255.0，后面的虚拟机被分配到的也都是这个网段。通过网卡共享、网卡桥接等，可以实现虚拟机于主机相互访问。

虚拟机与网络主机的关系：默认不能相互访问，原因同上，通过设置，可以实现相互访问。

虚拟机与虚拟机的关系：默认可以相互访问，都是同处于一个网段。

### 2.配置静态IP地址

虚拟机安装完成进入之后，开始配置静态IP地址

```
vi /etc/sysconfig/network-scripts/ifcfg-enp0s3
```

打开配置文件并编辑以下变量：

```
BOOTPROTO="static" 		#dhcp改为static   
ONBOOT="yes" 			#开机启用本配置  
IPADDR=192.168.1.151 	#静态IP  
GATEWAY=192.168.1.1 	#默认网关  
NETMASK=255.255.255.0 	#子网掩码  
```

没有的添加，有的修改。保存修改并使用以下命令来重启网络服务：

```
systemctl restart network.service
```

现在验证接口是否配置正确：

	ip add

查看 `enp0s3` 的 IP 是否是修改的 IPADDR。

之后就可以用 Xshell 连接虚拟服务器了。

### 3.Xshell连接报错

虚拟机用Xshell登陆报错“ssh服务器拒绝了密码”解决方法：

1、检查虚拟机SSH服务是否开启： 
`service sshd status`，如果没有开启，请执行`service sshd start`启动该服务，或者通过`service sshd restart`重启该服务；

2、检查 `/etc/ssh/ssh_config`文件： 
ssh服务端口是否为22，Protocol协议版本是否为2（一般为2安全。1为ssh 1不安全，有可能禁止登陆）； 

3.用Xshell root连接时显示ssh服务器拒绝了密码，应该是应该是sshd的设置不允许root用户用密码远程登录 
修改 /etc/ssh/sshd_config文件，注意，安装了openssh才会有这个文件，如果文件不存在请检查是否安装了openssh。

	vi /etc/ssh/sshd_config

找到

```
# Authentication:
LoginGraceTime 120
PermitRootLogin prohibit-password
StrictModes yes
```

改成

```
# Authentication:
LoginGraceTime 120
PermitRootLogin yes
StrictModes yes
```

重启虚拟机。

4.如果还不行，可以检查一下本机 IP。

服务器的 IP 地址为 192.168.1.151

cmd 中输入`ipconfig/all`，找到“以太网适配器 本地连接”的默认网关 192.168.0.1

把服务器的 IP 地址改为 192.168.0.151，我的就是这么解决的。